<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AK MASTER ADMIN - PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #005eb8; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f; --dark: #000; --running: #3498db; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background: #f4f7f6; color: var(--dark); padding-bottom: 30px; text-align: center; }
        .header { background: #fff; padding: 15px; border-bottom: 4px solid var(--primary); font-weight: bold; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #dashboard { padding: 15px; max-width: 500px; margin: auto; }
        
        /* 6 Indicators */
        .indicator-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .ind-box { background: white; padding: 12px 5px; border-radius: 12px; border: 2px solid #000; box-shadow: 3px 3px 0px #000; cursor: pointer; }
        .ind-box span { font-size: 10px; font-weight: 900; color: #555; display: block; text-transform: uppercase; }
        .ind-box b { font-size: 20px; color: var(--primary); }

        /* ID Status Machine */
        .status-panel { background: white; padding: 15px; border-radius: 15px; border: 2px solid #000; margin-bottom: 20px; box-shadow: 5px 5px 0px #000; }
        .input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #000; border-radius: 10px; font-size: 16px; text-align:center; font-weight:bold; outline: none; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .status-btn { padding: 14px; border: 2px solid #000; border-radius: 10px; color: #fff; font-weight: 800; cursor: pointer; font-size: 13px; }

        /* Bottom Menu */
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .panel-box { background: white; border-radius: 15px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #000; box-shadow: 4px 4px 0px #000; cursor: pointer; }
        .panel-box i { font-size: 26px; color: var(--primary); margin-bottom: 5px; }
        .panel-box span { font-size: 10px; font-weight: 900; text-align: center; }

        /* Modal Design */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; }
        .modal-content { position:relative; top:50%; left:50%; transform:translate(-50%,-50%); width:92%; max-height: 90vh; background:white; padding:20px; border-radius:20px; border:3px solid #000; overflow-y: auto; text-align: center; }
        .btn-action { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; color: white; font-size: 16px; }
        
        #loader { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:10001; justify-content:center; align-items:center; flex-direction: column; }
    </style>
</head>
<body>

<div id="loader">
    <i class="fas fa-cog fa-spin fa-3x" style="color:var(--primary);"></i>
    <p style="margin-top:10px; font-weight:bold;">‡§°‡•á‡§ü‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...</p>
</div>

<div class="header"><h2>AK MASTER ADMIN</h2></div>

<div id="dashboard">
    <div class="indicator-grid">
        <div class="ind-box"><span>‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó</span><b id="count-book">0</b></div>
        <div class="ind-box" style="border-color:var(--success)"><span>‡§°‡§®</span><b id="count-done">0</b></div>
        <div class="ind-box" style="border-color:var(--running)"><span>‡§∞‡§®‡§ø‡§Ç‡§ó</span><b id="count-run">0</b></div>
        <div class="ind-box" style="border-color:var(--warning)"><span>‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó</span><b id="count-pend">0</b></div>
        <div class="ind-box" style="border-color:var(--danger)"><span>‡§∞‡§ø‡§ú‡•á‡§ï‡•ç‡§ü</span><b id="count-rej">0</b></div>
        <div class="ind-box" style="background:#fff3cd"><span>‡§ü‡•Ä‡§Æ</span><b id="count-team">0</b></div>
    </div>

    <div class="status-panel">
        <h4 style="text-align:center;">üìä ‡§Ü‡§à‡§°‡•Ä ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Æ‡§∂‡•Ä‡§®</h4>
        <input type="text" id="targetId" class="input" placeholder="C-ID (‡§â‡§¶‡§æ: AK-101)">
        <div class="grid-2">
            <button class="status-btn" style="background:var(--success)" onclick="updateStatus('Done')">DONE</button>
            <button class="status-btn" style="background:var(--warning); color:#000;" onclick="updateStatus('Pending')">PENDING</button>
            <button class="status-btn" style="background:var(--running)" onclick="updateStatus('Running')">RUNNING</button>
            <button class="status-btn" style="background:var(--danger)" onclick="updateStatus('Reject')">REJECT</button>
        </div>
    </div>

    <div class="menu-grid">
        <div class="panel-box" onclick="openP('reg-p')"><i class="fas fa-user-plus"></i><span>TEAM REG</span></div>
        <div class="panel-box" onclick="loadList('TEAM')"><i class="fas fa-users-cog"></i><span>TEAM LIST</span></div>
        <div class="panel-box" onclick="openP('as-p')"><i class="fas fa-link"></i><span>ASSIGN</span></div>
        <div class="panel-box" onclick="loadList('CUST')"><i class="fas fa-database"></i><span>CUST DATA</span></div>
        <div class="panel-box" onclick="openP('id-p')"><i class="fas fa-id-card"></i><span>ID CARD</span></div>
        <div class="panel-box" onclick="syncCounts()"><i class="fas fa-sync"></i><span>REFRESH</span></div>
    </div>
</div>

<div id="reg-p" class="modal">
    <div class="modal-content">
        <h3 style="color:var(--primary); margin-bottom:15px;">‡§®‡§Ø‡§æ ‡§ü‡•Ä‡§Æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h3>
        <div id="otp-1">
            <input type="text" id="reg-name" class="input" placeholder="‡§®‡§æ‡§Æ">
            <input type="text" id="reg-father" class="input" placeholder="‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
            <input type="number" id="reg-phone" class="input" placeholder="‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ (91...)">
            <input type="text" id="reg-service" class="input" placeholder="‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏">
            <button class="btn-action" style="background:var(--primary)" onclick="sendOTP()">WhatsApp OTP ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        </div>
        <div id="otp-2" style="display:none;">
            <p style="color:green; font-weight:bold;">OTP ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à</p>
            <input type="number" id="otp-input" class="input" placeholder="OTP ‡§ï‡•ã‡§°">
            <button class="btn-action" style="background:var(--success)" onclick="verifyOTP()">‡§µ‡•á‡§∞‡§ø‡§´‡§æ‡§à ‡§î‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞</button>
        </div>
        <button class="btn-action" style="background:#666" onclick="closeP('reg-p')">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="id-p" class="modal">
    <div class="modal-content" style="max-width:400px;">
        <div id="id-card-render" style="width:100%; height:420px; border:2px solid #000; border-radius:15px; background:#fff; position:relative; overflow:hidden;">
            <div style="background:var(--primary); color:#fff; padding:10px; font-weight:bold;">AK SOLUTION HUB</div>
            <div style="text-align:center; margin-top:15px;">
                <img id="v-img" src="https://via.placeholder.com/100" style="width:100px; height:100px; border-radius:10px; border:1px solid #000;">
                <h2 id="v-name" style="margin-top:10px;">---</h2>
                <h4 id="v-id" style="color:red;">ID: T-XXXX</h4>
                <span id="v-svc" style="background:#eee; padding:3px 10px; border-radius:20px; font-size:12px;">EXPERT</span>
            </div>
            <div style="position:absolute; bottom:15px; width:100%; display:flex; justify-content:space-around; align-items:center;">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=50x50&data=AKSH" style="width:50px;">
                <p style="font-size:10px; font-weight:bold;">AK SOLUTION HUB<br>MOHIT APPROVED</p>
            </div>
        </div>
        <input type="text" id="id-load-id" class="input" placeholder="T-ID ‡§°‡§æ‡§≤‡•á‡§Ç">
        <button class="btn-action" style="background:var(--dark)" onclick="loadID()">LOAD ID</button>
        <button class="btn-action" style="background:var(--success)" onclick="saveID()">DOWNLOAD PHOTO</button>
        <button class="btn-action" style="background:#666" onclick="closeP('id-p')">CLOSE</button>
    </div>
</div>

<div id="list-p" class="modal">
    <div class="modal-content" style="width:98%;">
        <h3 id="lt">‡§≤‡§ø‡§∏‡•ç‡§ü</h3>
        <div id="lb" style="margin-top:10px; overflow-x:auto;"></div>
        <button class="btn-action" style="background:var(--danger)" onclick="closeP('list-p')">‡§µ‡§æ‡§™‡§∏</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxmh2ezhk9TFSaQtL5gaSf4GLUvIIY9bAqRqtGDwQmJjNinl_1UTBIg5joRlsX6uJu18Q/exec";
    let curOTP, tempS;

    window.onload = syncCounts;

    function openP(id) { document.getElementById(id).style.display = "block"; }
    function closeP(id) { document.getElementById(id).style.display = "none"; }

    async function syncCounts() {
        document.getElementById('loader').style.display = 'flex';
        try {
            let res = await fetch(SCRIPT_URL + "?action=getCounts");
            let d = await res.json();
            document.getElementById('count-book').innerText = d.total;
            document.getElementById('count-done').innerText = d.done;
            document.getElementById('count-run').innerText = d.run;
            document.getElementById('count-pend').innerText = d.pend;
            document.getElementById('count-rej').innerText = d.rej;
            document.getElementById('count-team').innerText = d.team;
        } catch(e) { console.log("Error"); }
        document.getElementById('loader').style.display = 'none';
    }

    function sendOTP() {
        const n = document.getElementById('reg-name').value;
        const p = document.getElementById('reg-phone').value;
        if(!n || !p) return alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç");
        curOTP = Math.floor(1000 + Math.random() * 9000);
        tempS = { name:n, phone:p, father:document.getElementById('reg-father').value, service:document.getElementById('reg-service').value };
        window.open(`https://wa.me/${p}?text=AK%20SOLUTION%20HUB%20OTP:%20${curOTP}`, '_blank');
        document.getElementById('otp-1').style.display = 'none';
        document.getElementById('otp-2').style.display = 'block';
    }

    async function verifyOTP() {
        if(document.getElementById('otp-input').value != curOTP) return alert("Wrong OTP");
        document.getElementById('loader').style.display = 'flex';
        const params = new URLSearchParams({ action: 'addTeam', ...tempS });
        await fetch(`${SCRIPT_URL}?${params.toString()}`, {mode:'no-cors'});
        alert("Success! Staff Registered.");
        closeP('reg-p');
        syncCounts();
    }

    async function updateStatus(st) {
        let id = document.getElementById('targetId').value;
        if(!id) return alert("ID??");
        document.getElementById('loader').style.display = 'flex';
        await fetch(`${SCRIPT_URL}?action=updateStatus&id=${id}&status=${st}`, {mode:'no-cors'});
        alert("OK!");
        syncCounts();
    }

    async function loadList(type) {
        document.getElementById('loader').style.display = 'flex';
        let res = await fetch(`${SCRIPT_URL}?action=getList&type=${type}`);
        let data = await res.json();
        let h = "<table border='1' style='width:100%; border-collapse:collapse;'><tr><th>ID</th><th>Name</th><th>Status</th></tr>";
        data.forEach(r => { h += `<tr><td>${r.ID}</td><td>${r.Name}</td><td>${r.Status || r.Service}</td></tr>`; });
        document.getElementById('lb').innerHTML = h + "</table>";
        document.getElementById('lt').innerText = type + " LIST";
        openP('list-p');
        document.getElementById('loader').style.display = 'none';
    }

    async function loadID() {
        let tid = document.getElementById('id-load-id').value;
        document.getElementById('loader').style.display = 'flex';
        let res = await fetch(`${SCRIPT_URL}?action=getList&type=TEAM`);
        let data = await res.json();
        let s = data.find(x => x.ID == tid);
        if(s) {
            document.getElementById('v-name').innerText = s.Name;
            document.getElementById('v-id').innerText = "ID: " + s.ID;
            document.getElementById('v-svc').innerText = s.Service || "EXPERT";
        } else { alert("Not Found"); }
        document.getElementById('loader').style.display = 'none';
    }

    function saveID() {
        html2canvas(document.getElementById('id-card-render')).then(c => {
            let l = document.createElement('a');
            l.download = 'ID_CARD.png';
            l.href = c.toDataURL();
            l.click();
        });
    }
</script>
</body>
</html>
