<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AK MASTER ADMIN - PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #005eb8; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f; --dark: #1a1a1a; --running: #3498db; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background: #f0f2f5; color: var(--dark); padding-bottom: 30px; }
        
        #login-screen { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--primary); z-index:100000; display:flex; justify-content:center; align-items:center; }
        .login-card { background:white; padding:30px; border-radius:20px; width:90%; max-width:350px; text-align:center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 4px solid var(--primary); font-weight: bold; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #admin-content { display:none; padding: 15px; max-width: 500px; margin: auto; }
        
        .indicator-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .ind-box { background: white; padding: 12px 5px; border-radius: 12px; border: 2px solid #000; text-align: center; box-shadow: 4px 4px 0px #000; cursor: pointer; transition: 0.2s; }
        .ind-box:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000; }
        .ind-box b { font-size: 18px; color: var(--primary); display: block; }
        .ind-box span { font-size: 9px; font-weight: 900; color: #555; text-transform: uppercase; }

        .status-panel { background: white; padding: 15px; border-radius: 15px; border: 2px solid #000; margin-bottom: 20px; box-shadow: 5px 5px 0px #000; }
        .input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #000; border-radius: 10px; font-size: 15px; font-weight: bold; text-align: center; outline: none; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .panel-box { background: white; border-radius: 15px; height: 85px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #000; box-shadow: 3px 3px 0px #000; cursor: pointer; }
        .panel-box i { font-size: 22px; color: var(--primary); margin-bottom: 5px; }
        .panel-box span { font-size: 9px; font-weight: 900; }

        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; overflow-y: auto; }
        .modal-content { position:relative; top:50%; left:50%; transform:translate(-50%,-50%); width:92%; background:white; padding:20px; border-radius:20px; border:3px solid #000; }
        .btn-action { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #000; font-weight: bold; margin-top: 10px; cursor: pointer; color: white; border-bottom: 5px solid rgba(0,0,0,0.2); }

        /* ID CARD DESIGN */
        #id-card-view { width: 260px; margin: auto; background: white; border: 2px solid #000; border-radius: 15px; overflow: hidden; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .card-header { background: linear-gradient(90deg, #f1c40f 50%, #005eb8 50%); height: 50px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 2px #000; }
        .card-photo { width: 90px; height: 90px; background: #eee; border-radius: 50%; margin: -25px auto 10px; border: 3px solid white; overflow: hidden; cursor: pointer; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card-info { padding: 10px; text-align: center; font-size: 12px; }
        .card-footer { background: #000; color: white; font-size: 10px; padding: 6px; text-align: center; }

        #loader { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:1000000; justify-content:center; align-items:center; flex-direction: column; font-weight:bold; }
        .data-card { background: #f9f9f9; padding: 12px; border: 2px solid #eee; border-radius: 12px; margin-bottom: 10px; font-size: 12px; border-left: 5px solid var(--primary); }
    </style>
</head>
<body>

<div id="loader">
    <i class="fas fa-sync fa-spin fa-3x" style="color:var(--primary);"></i>
    <p style="margin-top:10px;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
</div>

<div id="login-screen">
    <div class="login-card">
        <i class="fas fa-user-shield fa-4x" style="color:var(--primary); margin-bottom:15px;"></i>
        <h2 style="margin-bottom:15px;">AK MASTER ADMIN</h2>
        <input type="password" id="passKey" class="input" placeholder="‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§™‡§ø‡§® ‡§°‡§æ‡§≤‡•á‡§Ç">
        <button class="btn-action" style="background:var(--primary)" onclick="checkLogin()">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
    </div>
</div>

<div id="admin-content">
    <div class="header"><h2>AK MASTER DASHBOARD</h2></div>

    <div class="indicator-grid" id="counts-div">
        <div class="ind-box"><span>‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó</span><b id="count-book">0</b></div>
        <div class="ind-box" style="border-color:var(--success)"><span>‡§°‡§®</span><b id="count-done">0</b></div>
        <div class="ind-box" style="border-color:var(--running)"><span>‡§∞‡§®‡§ø‡§Ç‡§ó</span><b id="count-run">0</b></div>
        <div class="ind-box" style="border-color:var(--warning)"><span>‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó</span><b id="count-pend">0</b></div>
        <div class="ind-box" style="border-color:var(--danger)"><span>‡§∞‡§ø‡§ú‡•á‡§ï‡•ç‡§ü</span><b id="count-rej">0</b></div>
        <div class="ind-box" style="background:#fff3cd"><span>‡§ü‡•Ä‡§Æ‡•ç‡§∏</span><b id="count-team">0</b></div>
    </div>

    <div class="status-panel">
        <p style="font-size:12px; font-weight:bold; margin-bottom:5px; color:#555;">‡§ï‡•ç‡§µ‡§ø‡§ï ‡§Ö‡§™‡§°‡•á‡§ü (C-ID ‡§°‡§æ‡§≤‡•á‡§Ç):</p>
        <input type="text" id="targetId" class="input" placeholder="‡§â‡§¶‡§æ: AK-8899">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button class="btn-action" style="background:var(--success)" onclick="updateStatus('DONE')">DONE</button>
            <button class="btn-action" style="background:var(--danger)" onclick="updateStatus('REJECT')">REJECT</button>
        </div>
    </div>

    <div class="menu-grid">
        <div class="panel-box" onclick="openModal('reg-p')"><i class="fas fa-user-plus"></i><span>TEAM REG</span></div>
        <div class="panel-box" onclick="openModal('id-card-p')"><i class="fas fa-id-card"></i><span>ID CARD</span></div>
        <div class="panel-box" onclick="openModal('assign-p')"><i class="fas fa-link"></i><span>ASSIGN</span></div>
        <div class="panel-box" onclick="fetchList('TEAM')"><i class="fas fa-users"></i><span>TEAM LIST</span></div>
        <div class="panel-box" onclick="fetchList('CUST')"><i class="fas fa-database"></i><span>CUST DATA</span></div>
        <div class="panel-box" onclick="location.reload()"><i class="fas fa-sync-alt"></i><span>REFRESH</span></div>
    </div>
</div>

<div id="reg-p" class="modal">
    <div class="modal-content">
        <h3 style="text-align:center; color:var(--primary);"><i class="fas fa-user-plus"></i> ‡§®‡§Ø‡§æ ‡§ü‡•Ä‡§Æ ‡§Æ‡•á‡§Ç‡§¨‡§∞</h3>
        <input type="text" id="tName" class="input" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="tFather" class="input" placeholder="‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <input type="tel" id="tPhone" class="input" placeholder="‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§®‡§Ç‡§¨‡§∞">
        <textarea id="tAddr" class="input" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ" rows="2"></textarea>
        <button class="btn-action" style="background:var(--success)" onclick="submitTeam()">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        <button class="btn-action" style="background:var(--dark)" onclick="closeModal('reg-p')">‡§ï‡•à‡§Ç‡§∏‡§ø‡§≤</button>
    </div>
</div>

<div id="id-card-p" class="modal">
    <div class="modal-content">
        <h3>‡§Ü‡§à‡§°‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ú‡§®‡§∞‡•á‡§ü‡§∞</h3>
        <input type="text" id="searchTID" class="input" placeholder="‡§ü‡•Ä‡§Æ ID ‡§°‡§æ‡§≤‡•á‡§Ç">
        <button class="btn-action" style="background:var(--primary)" onclick="loadIdCard()">‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç</button>
        
        <div id="id-card-view" style="display:none; margin-top:20px;">
            <div class="card-header">AK HUB OFFICIAL</div>
            <div class="card-photo" onclick="document.getElementById('fileInp').click()">
                <img id="previewImg" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                <i id="cam" class="fas fa-camera" style="margin: 30px 32px; font-size:25px; color:#aaa;"></i>
            </div>
            <input type="file" id="fileInp" accept="image/*" hidden onchange="showImg(event)">
            <div class="card-info">
                <h3 id="cName" style="text-transform:uppercase;">NAME</h3>
                <p id="cID" style="color:red; font-weight:bold; margin:5px 0;">AK-T000</p>
                <p id="cFather">Father: ---</p>
                <p id="cPhone">Phone: ---</p>
            </div>
            <div class="card-footer">
                <marquee scrollamount="2">AKSOLUTION HUB - ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§î‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ</marquee>
            </div>
        </div>
        <button class="btn-action" style="background:var(--dark)" onclick="closeModal('id-card-p')">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="assign-p" class="modal">
    <div class="modal-content">
        <h3 style="color:var(--running); text-align:center;"><i class="fas fa-link"></i> ‡§ï‡§æ‡§Æ ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç</h3>
        <input type="text" id="asCID" class="input" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ID (C-ID)">
        <input type="text" id="asTID" class="input" placeholder="‡§ü‡•Ä‡§Æ ID (T-ID)">
        <div style="background:#e8f4fd; padding:10px; border-radius:10px; font-size:11px; margin:10px 0;">
            * ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•Ä ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ <b>RUNNING</b> ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§
        </div>
        <button class="btn-action" style="background:var(--success)" onclick="submitAssign()">‡§Ö‡§∏‡§æ‡§á‡§® ‡§î‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        <button class="btn-action" style="background:var(--dark)" onclick="closeModal('assign-p')">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="list-p" class="modal">
    <div class="modal-content">
        <h3 id="list-title" style="text-align:center; margin-bottom:10px;">‡§°‡•á‡§ü‡§æ ‡§≤‡§ø‡§∏‡•ç‡§ü</h3>
        <input type="text" id="searchBar" class="input" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç..." onkeyup="searchList()">
        <div id="list-body" style="margin-top:10px; max-height: 350px; overflow-y: auto; padding-right:5px;"></div>
        <button class="btn-action" style="background:var(--danger)" onclick="closeModal('list-p')">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<script>
    // ‡§Ü‡§™‡§ï‡•Ä ‡§®‡§à Script URL
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxRmjB3e9NAHO5m8cwUzb3HGz3j873ZVKUoFhmP4LicDc9qN7_tZzZsGT-pg1-4OstMBA/exec';

    function checkLogin() {
        if(document.getElementById('passKey').value === "Ak2525") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            loadDashboard();
        } else { alert("‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!"); }
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function toggleLoader(v) { document.getElementById('loader').style.display = v ? 'flex' : 'none'; }

    async function loadDashboard() {
        toggleLoader(true);
        try {
            const res = await fetch(scriptURL + "?action=readBookings");
            const data = await res.json();
            document.getElementById('count-book').innerText = data.length;
            document.getElementById('count-done').innerText = data.filter(i => i.Status === 'DONE').length;
            document.getElementById('count-run').innerText = data.filter(i => i.Status === 'RUNNING').length;
            document.getElementById('count-pend').innerText = data.filter(i => i.Status === 'PENDING').length;
            document.getElementById('count-rej').innerText = data.filter(i => i.Status === 'REJECT').length;
            
            const tRes = await fetch(scriptURL + "?action=readTeam");
            const tData = await tRes.json();
            document.getElementById('count-team').innerText = tData.length;
        } catch(e) { console.error("Dashboard Load Error"); }
        toggleLoader(false);
    }

    async function submitTeam() {
        const name = document.getElementById('tName').value.trim();
        const phone = document.getElementById('tPhone').value.trim();
        const father = document.getElementById('tFather').value.trim();
        const addr = document.getElementById('tAddr').value.trim();

        if(!name || !phone) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§´‡•ã‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç!");

        const uID = "AK-T" + Math.floor(1000 + Math.random() * 9000);
        toggleLoader(true);
        try {
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ action: 'regTeam', id: uID, name, father, phone, address: addr })
            });
            const msg = `*AK HUB - ‡§ü‡•Ä‡§Æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®*%0AüÜî ‡§Ø‡•Ç‡§®‡§ø‡§ï ‡§Ü‡§à‡§°‡•Ä: ${uID}%0Aüë§ ‡§®‡§æ‡§Æ: ${name}%0Aüìû ‡§´‡•ã‡§®: ${phone}%0Aüë¥ ‡§™‡§ø‡§§‡§æ: ${father}`;
            window.open(`https://wa.me/91${phone}?text=${msg}`, '_blank');
            alert("‡§ü‡•Ä‡§Æ ‡§Æ‡•á‡§Ç‡§¨‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à! ID: " + uID);
            location.reload();
        } catch(e) { alert("Error saving team!"); }
        toggleLoader(false);
    }

    async function loadIdCard() {
        const tid = document.getElementById('searchTID').value.trim().toUpperCase();
        if(!tid) return alert("‡§ü‡•Ä‡§Æ ID ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç!");
        toggleLoader(true);
        try {
            const res = await fetch(scriptURL + "?action=readTeam");
            const data = await res.json();
            const user = data.find(i => i.ID === tid);
            if(user) {
                document.getElementById('cName').innerText = user.Name;
                document.getElementById('cID').innerText = "ID: " + user.ID;
                document.getElementById('cFather').innerText = "Father: " + user.Father;
                document.getElementById('cPhone').innerText = "Phone: " + user.Phone;
                document.getElementById('id-card-view').style.display = 'block';
            } else { alert("‡§Ø‡§π ID ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä!"); }
        } catch(e) { alert("Fetch Error!"); }
        toggleLoader(false);
    }

    function showImg(e) {
        const reader = new FileReader();
        reader.onload = () => {
            const img = document.getElementById('previewImg');
            img.src = reader.result;
            img.style.display = 'block';
            document.getElementById('cam').style.display = 'none';
        }
        reader.readAsDataURL(e.target.files[0]);
    }

    async function submitAssign() {
        const cid = document.getElementById('asCID').value.trim().toUpperCase();
        const tid = document.getElementById('asTID').value.trim().toUpperCase();
        if(!cid || !tid) return alert("C-ID ‡§î‡§∞ T-ID ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§≠‡§∞‡•á‡§Ç!");

        toggleLoader(true);
        try {
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ action: 'updateStatus', id: cid, status: 'RUNNING', assignTo: tid })
            });
            const msg = `*AK HUB - ‡§®‡§Ø‡§æ ‡§ï‡§æ‡§Æ ‡§Ö‡§∏‡§æ‡§á‡§®*%0A------------------%0Aüìå Job ID: ${cid}%0Aüë∑ Team ID: ${tid}%0Aüìä Status: RUNNING%0A------------------%0A‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§`;
            window.open(`https://wa.me/?text=${msg}`, '_blank');
            alert("‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!");
            location.reload();
        } catch(e) { alert("Error updating status!"); }
        toggleLoader(false);
    }

    async function updateStatus(s) {
        const id = document.getElementById('targetId').value.trim().toUpperCase();
        if(!id) return alert("‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ID (C-ID) ‡§°‡§æ‡§≤‡•á‡§Ç!");
        toggleLoader(true);
        try {
            await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'updateStatus', id, status: s }) });
            alert("‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ " + s + " ‡§™‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!");
            loadDashboard();
            document.getElementById('targetId').value = "";
        } catch(e) { alert("Update Error!"); }
        toggleLoader(false);
    }

    async function fetchList(type) {
        toggleLoader(true);
        openModal('list-p');
        document.getElementById('list-title').innerText = (type === 'TEAM') ? "‡§ü‡•Ä‡§Æ ‡§°‡•á‡§ü‡§æ ‡§≤‡§ø‡§∏‡•ç‡§ü" : "‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞ ‡§°‡•á‡§ü‡§æ ‡§≤‡§ø‡§∏‡•ç‡§ü";
        const body = document.getElementById('list-body');
        const action = (type === 'TEAM') ? "readTeam" : "readBookings";
        try {
            const res = await fetch(scriptURL + "?action=" + action);
            const data = await res.json();
            body.innerHTML = data.reverse().map(i => `
                <div class="data-card">
                    <b>ID:</b> ${i.ID} | <b>Status:</b> <span style="color:${getStatusColor(i.Status)}">${i.Status || 'Active'}</span><br>
                    <b>Name:</b> ${i.Name}<br>
                    <b>Phone:</b> ${i.Phone}<br>
                    <b>Details:</b> ${i.Service || i.Father || 'N/A'}
                </div>
            `).join('');
        } catch(e) { body.innerHTML = "‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à‡•§"; }
        toggleLoader(false);
    }

    function getStatusColor(s) {
        if(s === 'DONE') return 'var(--success)';
        if(s === 'RUNNING') return 'var(--running)';
        if(s === 'REJECT') return 'var(--danger)';
        if(s === 'PENDING') return 'var(--warning)';
        return '#000';
    }

    function searchList() {
        let filter = document.getElementById('searchBar').value.toUpperCase();
        let cards = document.getElementsByClassName('data-card');
        for (let i = 0; i < cards.length; i++) {
            cards[i].style.display = cards[i].innerText.toUpperCase().indexOf(filter) > -1 ? "" : "none";
        }
    }
</script>
</body>
</html>