<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AK SOLUTION HUB - Smart Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #005eb8; --bg: #ffffff; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); padding-bottom: 90px; }
        
        /* UI Elements */
        .header { text-align: center; padding: 10px; background: #fff; border-bottom: 1px solid #ddd; }
        .logo-img { width: 75px; height: 75px; border-radius: 50%; border: 2px solid var(--primary); }
        .header h1 { color: var(--primary); font-size: 22px; }
        .ticker { background: var(--primary); color: #fff; padding: 8px; overflow: hidden; white-space: nowrap; font-size: 13px; font-weight: bold; }
        
        .slider-box { width: 94%; margin: 15px auto; border-radius: 15px; overflow: hidden; height: 170px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .slider { display: flex; transition: 0.5s; height: 100%; width: 500%; }
        .slider img { width: 20%; flex-shrink: 0; object-fit: cover; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .box { background: #f8f9fa; border-radius: 12px; height: 95px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .box i { font-size: 24px; color: var(--primary); margin-bottom: 5px; }
        .box span { font-size: 10px; font-weight: 800; text-transform: uppercase; text-align: center; }

        /* Admin & Stats */
        #admin-panel-content { display: none; }
        .dashboard-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 10px; }
        .stat-box { border-radius: 8px; padding: 15px 0; text-align: center; color: white; border: 2px solid #333; cursor: pointer; font-size: 10px; font-weight: bold; }
        .bg-pending { background: var(--warning); color: #000; }
        .bg-running { background: #3498db; }
        .bg-done    { background: var(--success); }
        .bg-reject  { background: var(--danger); }
        
        .admin-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 15px; }
        .adm-box { background: #fff; border-radius: 12px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #333; box-shadow: 4px 4px 0px #333; cursor: pointer; }
        .adm-box span { font-size: 10px; font-weight: 900; }

        /* Navigation */
        .page { display: none; padding: 20px; }
        .active-page { display: block !important; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; height: 75px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 11px; padding-top: 15px; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; }
        .active-nav { color: var(--primary); font-weight: bold; }
        
        /* Modals & Inputs */
        .input { width: 100%; padding: 12px; margin: 10px 0; border: 1.5px solid #ddd; border-radius: 8px; outline: none; display: block; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:5000; }
        .modal-content { position:relative; top:50%; left:50%; transform:translate(-50%,-50%); width:94%; max-height:85vh; background:white; padding:20px; border-radius:15px; overflow-y:auto; border-top:5px solid var(--primary); }

        /* List Specific Styles */
        .team-card { background: #fff; border-radius: 12px; padding: 12px; margin-bottom: 10px; border: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .dot-free { background: var(--success); }
        .dot-busy { background: var(--danger); }
        .stat-filter-btn { flex: 1; padding: 8px; border: 1px solid #ddd; background: #fff; border-radius: 5px; font-size: 11px; font-weight: bold; }
        .active-f { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* New Broadcast Styles */
        .cust-check { width: 18px; height: 18px; margin-right: 10px; accent-color: var(--primary); }
    </style>
</head>
<body>

<div class="header"><img src="57255.jpg" class="logo-img"><h1>AK SOLUTION HUB</h1></div>
<div class="ticker"><marquee>‚ö° ‡§∏‡•Ä‡§∏‡•Ä‡§ü‡•Ä‡§µ‡•Ä | ‡§Ü‡§∞‡§ì | ‡§™‡•ç‡§≤‡§Ç‡§¨‡§∞ | ‡§ï‡§æ‡§∞‡§™‡•á‡§Ç‡§ü‡§∞ | ‡§è‡§∏‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ | 9927464530 ‚ö°</marquee></div>

<div id="home-page" class="page active-page">
    <div class="slider-box"><div class="slider" id="mainSlider"><img src="1.jpg"><img src="2.jpg"><img src="3.jpg"><img src="4.jpg"><img src="5.jpg"></div></div>
    <div class="grid" id="main-grid">
        <div class="box" onclick="openSub('PLUMBER')"><i class="fas fa-faucet"></i><span>PLUMBER</span></div>
        <div class="box" onclick="openSub('ELECTRICIAN')"><i class="fas fa-bolt"></i><span>ELECTRICIAN</span></div>
        <div class="box" onclick="openSub('CARPENTER')"><i class="fas fa-hammer"></i><span>CARPENTER</span></div>
        <div class="box" onclick="openSub('RO SERVICE')"><i class="fas fa-tint"></i><span>RO SERVICE</span></div>
        <div class="box" onclick="openSub('CCTV')"><i class="fas fa-video"></i><span>CCTV</span></div>
        <div class="box" onclick="openSub('FITTING')"><i class="fas fa-tools"></i><span>FITTING</span></div>
        <div class="box" onclick="openSub('CLEANING')"><i class="fas fa-broom"></i><span>CLEANING</span></div>
        <div class="box" onclick="openSub('AC SERVICE')"><i class="fas fa-snowflake"></i><span>AC SERVICE</span></div>
        <div class="box" onclick="openSub('OTHER')"><i class="fas fa-plus-circle"></i><span>OTHER</span></div>
    </div>
</div>

<div id="sub-svc-modal" class="modal">
    <div class="modal-content">
        <h3 id="parent-svc-name" style="text-align:center; color:var(--primary); margin-bottom:15px;">‡§∏‡•á‡§µ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</h3>
        <div id="sub-list-container" class="grid" style="grid-template-columns: repeat(2, 1fr); padding:0; gap:8px;"></div>
        <button onclick="document.getElementById('sub-svc-modal').style.display='none'" style="width:100%; padding:10px; background:#333; color:white; border-radius:10px; margin-top:15px; border:none;">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å</button>
    </div>
</div>

<div id="booking-page" class="page">
    <h2 id="svc-title" style="text-align:center; color:var(--primary);">‡§∏‡•á‡§µ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</h2>
    <input type="text" id="uName" class="input" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
    <input type="tel" id="uPhone" class="input" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
    <textarea id="uAddr" class="input" rows="3" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ"></textarea>
    <button id="locBtn" onclick="askLocation()" style="background:#3498db; color:white; width:100%; padding:15px; border-radius:10px; border:none;">üìç ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§¶‡•á‡§Ç (GPS)</button>
    <button id="finalBtn" onclick="finalSubmit()" style="display:none; margin-top:10px; background:var(--success); color:white; width:100%; padding:15px; border-radius:10px; border:none;">‚úÖ ‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ</button>
</div>

<div id="admin-page" class="page">
    <div id="admin-login-box">
        <h2 style="text-align:center;">üîê ‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="password" id="pin" class="input" placeholder="‡§™‡§ø‡§® ‡§°‡§æ‡§≤‡•á‡§Ç">
        <button style="background:#333; color:white; width:100%; padding:15px; border-radius:10px; border:none;" onclick="checkAdmin()">‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
    </div>
    
    <div id="admin-panel-content">
        <h2 style="text-align:center; color:var(--primary); font-size:18px; text-decoration:underline; margin-bottom:10px;">ADMIN DASHBOARD</h2>
        <input type="text" id="updId" class="input" style="border:2px solid var(--primary);" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ID (‡§â‡§¶‡§æ: AK-1120)">
        <div class="dashboard-stats">
            <div class="stat-box bg-done" onclick="updStatus('DONE')">DONE</div>
            <div class="stat-box bg-pending" onclick="updStatus('PENDING')">PENDING</div>
            <div class="stat-box bg-running" onclick="updStatus('RUNNING')">RUNNING</div>
            <div class="stat-box bg-reject" onclick="updStatus('REJECT')">REJECT</div>
        </div>
        <div class="admin-grid">
            <div class="adm-box" onclick="alert('Reg Open')"><i class="fas fa-user-plus"></i><span>TEAM REG</span></div>
            <div class="adm-box" onclick="openIDEntry()"><i class="fas fa-id-card"></i><span>ID CARD</span></div>
            <div class="adm-box" onclick="openAssignModal()"><i class="fas fa-tasks"></i><span>ASSIGN</span></div>
            <div class="adm-box" style="background:#e3f2fd;" onclick="openCustData()"><i class="fas fa-folder"></i><span>CUST DATA</span></div>
            <div class="adm-box" style="background:#e8f5e9;" onclick="openTeamList()"><i class="fas fa-users"></i><span>TEAM DATA</span></div>
            <div class="adm-box" onclick="openOfferModal()"><i class="fas fa-bullhorn"></i><span>OFFER</span></div>
        </div>
    </div>
</div>

<div id="cust-list-modal" class="modal">
    <div class="modal-content" style="width:96%; height:90vh;">
        <h3 style="text-align:center; color:var(--primary);"><i class="fas fa-users"></i> ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§≤‡§ø‡§∏‡•ç‡§ü</h3>
        <input type="text" id="cSearchId" onkeyup="filterCust()" class="input" placeholder="ID ‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç...">
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; background:#f0f7ff; padding:10px; border-radius:8px; border:1px solid #cce3f6;">
            <label style="font-size:12px; font-weight:bold; color:var(--primary);">
                <input type="checkbox" id="selectAllCust" onclick="toggleAllCust()"> ‡§∏‡§¨‡§ï‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç
            </label>
            <button onclick="openOfferModal()" style="background:var(--success); color:white; border:none; padding:6px 15px; border-radius:50px; font-size:11px; font-weight:bold;">‡§ë‡§´‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        </div>

        <div id="cust-container"></div>
        <button onclick="document.getElementById('cust-list-modal').style.display='none'" style="width:100%; padding:10px; background:red; color:white; border:none; border-radius:8px; margin-top:10px;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="offer-modal" class="modal">
    <div class="modal-content" style="border-top:5px solid var(--warning);">
        <h3 style="text-align:center; color:#333;"><i class="fas fa-bullhorn"></i> ‡§ß‡§Æ‡§æ‡§ï‡§æ ‡§ë‡§´‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç</h3>
        <textarea id="offerMessage" class="input" rows="5" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§™‡§®‡§æ ‡§ë‡§´‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç... (‡§â‡§¶‡§æ: ‡§Ü‡§ú ‡§∏‡§≠‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§™‡§∞ ‚Çπ100 ‡§ï‡•Ä ‡§õ‡•Ç‡§ü ‡§π‡•à!)"></textarea>
        <button onclick="startBroadcast()" style="width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:10px; font-weight:bold;">üöÄ ‡§¨‡•ç‡§∞‡•â‡§°‡§ï‡§æ‡§∏‡•ç‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
        <button onclick="document.getElementById('offer-modal').style.display='none'" style="width:100%; background:none; border:none; color:red; margin-top:10px;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="team-list-modal" class="modal">
    <div class="modal-content" style="width:96%; height:90vh;">
        <h3 style="text-align:center; color:var(--primary);">üë• ‡§ü‡•Ä‡§Æ ‡§≤‡§ø‡§∏‡•ç‡§ü</h3>
        <input type="text" id="tSearchId" onkeyup="filterTeam()" class="input" placeholder="ID ‡§∏‡•á ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç...">
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button onclick="setTFilter('ALL')" id="f-all" class="stat-filter-btn active-f">‡§∏‡§¨</button>
            <button onclick="setTFilter('FREE')" id="f-free" class="stat-filter-btn">üü¢ FREE</button>
            <button onclick="setTFilter('BUSY')" id="f-busy" class="stat-filter-btn">üî¥ BUSY</button>
        </div>
        <div id="team-container"></div>
        <button onclick="document.getElementById('team-list-modal').style.display='none'" style="width:100%; padding:10px; background:red; color:white; border:none; border-radius:8px; margin-top:10px;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="assign-modal" class="modal">
    <div class="modal-content" style="border-top:5px solid var(--primary); text-align:center;">
        <i class="fas fa-link" style="font-size:30px; color:var(--primary); margin-bottom:10px;"></i>
        <h3 style="color:var(--primary); margin-bottom:15px;">‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç</h3>
        <input type="text" id="assign-cust-id" class="input" style="text-align:center; font-weight:bold;" placeholder="CUST ID (AK-XXXX)">
        <input type="text" id="assign-team-id" class="input" style="text-align:center; font-weight:bold;" placeholder="WORKER ID (TEAM-XXXX)">
        <button onclick="processAssign()" style="width:100%; padding:15px; background:var(--primary); color:white; border-radius:10px; border:none; font-weight:bold;">‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§ö ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        <button onclick="document.getElementById('assign-modal').style.display='none'" style="width:100%; background:none; border:none; color:red; margin-top:10px;">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="id-entry-modal" class="modal">
    <div class="modal-content" style="text-align:center; border-top:5px solid var(--primary);">
        <i class="fas fa-search" style="font-size:30px; color:var(--primary); margin-bottom:10px;"></i>
        <h3 style="color:var(--primary);">‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ñ‡•ã‡§ú‡•á‡§Ç</h3>
        <input type="text" id="custom-id-input" class="input" style="text-align:center; font-weight:bold;" placeholder="AK-1001 ‡§Ø‡§æ TEAM-2001">
        <button onclick="startFetchingID()" style="width:100%; padding:15px; background:var(--primary); color:white; border-radius:10px; border:none; font-weight:bold;">‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§à‡§°‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Å</button>
        <button onclick="document.getElementById('id-entry-modal').style.display='none'" style="width:100%; background:none; border:none; color:red; margin-top:10px;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<div id="id-card-modal" class="modal">
    <div class="modal-content" style="text-align:center; padding:0; border:none; width:330px; background:transparent;">
        <div id="id-card-print" style="background:#fff; border-radius:15px; overflow:hidden; width:300px; margin:auto; border:1px solid #ddd; position:relative;">
            <div style="background:#005eb8; height:110px; padding:20px 10px; color:#fff; position:relative;">
                <h3 style="margin:0; font-size:18px;">AK SOLUTION HUB</h3>
                <div style="width:110px; height:110px; background:#fff; border:4px solid #fff; border-radius:10px; position:absolute; bottom:-55px; left:50%; transform:translateX(-50%); overflow:hidden;">
                    <img id="worker-img-preview" style="width:100%; height:100%; object-fit:cover; display:none;">
                    <i id="cam-icon" class="fas fa-camera" style="font-size:40px; color:#ddd; margin-top:30px;"></i>
                    <input type="file" accept="image/*" capture="camera" id="cam-input" onchange="previewImg(this)" style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; z-index:10;">
                    <div id="digital-stamp" style="display:none; position:absolute; bottom:5px; right:5px; width:55px; height:55px; border:2px double #005eb8; border-radius:50%; color:#005eb8; font-weight:900; font-size:8px; display:flex; align-items:center; justify-content:center; flex-direction:column; transform: rotate(-20deg); background:rgba(255,255,255,0.6); z-index:5;">
                        <span>APPROVED</span><span>AK SOLUTION</span>
                    </div>
                </div>
            </div>
            <div style="padding:65px 20px 20px 20px; background:#fff;">
                <h2 id="card-name" style="font-size:20px; color:#333; margin:0;">‡§®‡§æ‡§Æ</h2>
                <p id="card-father" style="font-size:13px; color:#777; margin:5px 0;">‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</p>
                <div style="margin:10px 0; border-top:1px solid #eee; border-bottom:1px solid #eee; padding:5px 0;">
                    <b id="card-svc" style="color:#005eb8; font-size:15px;">SERVICE</b>
                </div>
                <div style="display:flex; justify-content:space-between; text-align:left; font-size:11px;">
                    <div>ID: <b id="card-id">AK-0000</b></div>
                    <div style="text-align:right;">Ph: <b id="card-phone">9927464530</b></div>
                </div>
            </div>
            <div style="background:#005eb8; padding:8px; color:#fff; font-size:14px; font-weight:bold; letter-spacing:2px;">AK SOLUTION</div>
        </div>
        <div style="padding:20px;">
            <button onclick="sendIDAsPDF()" style="width:100%; padding:15px; background:#25d366; color:#fff; border:none; border-radius:50px; font-weight:bold;"><i class="fab fa-whatsapp"></i> ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ PDF ‡§≠‡•á‡§ú‡•á‡§Ç</button>
            <button onclick="document.getElementById('id-card-modal').style.display='none'" style="width:100%; padding:10px; background:none; border:none; color:#fff; margin-top:10px;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active-nav" onclick="showPage('home-page', this)"><i class="fas fa-home"></i>Home</div>
    <div class="nav-item" onclick="showPage('booking-page', this)"><i class="fas fa-calendar-alt"></i>Booking</div>
    <div class="nav-item" onclick="showPage('admin-page', this)"><i class="fas fa-user-shield"></i>Admin</div>
</nav>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxa_iIYrtRL9iEhn2pDaOarZRazqx_R2RUbLwFWjSPiTx4BBEt9Gq2Fr-I0sRPe_eQnug/exec';
    
    // --- BASIC NAVIGATION ---
    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(id).classList.add('active-page');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        if(el) el.classList.add('active-nav');
    }

    function checkAdmin() {
        if(document.getElementById('pin').value === "Ak2525") {
            document.getElementById('admin-login-box').style.display = 'none';
            document.getElementById('admin-panel-content').style.display = 'block';
        } else alert("‡§ó‡§≤‡§§ ‡§™‡§ø‡§®!");
    }

    // --- STATUS UPDATE (ADDED) ---
    async function updStatus(status) {
        const id = document.getElementById('updId').value.trim().toUpperCase();
        if(!id) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ID ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç!");
        try {
            const response = await fetch(`${scriptURL}?action=update&id=${id}&status=${status}`);
            alert(`ID: ${id} ‡§ï‡§æ ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ${status} ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!`);
        } catch(e) {
            alert("‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à!");
        }
    }

    // --- SUB SERVICES ---
    const subServices = {
        'PLUMBER': ['‡§®‡§≤ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞', '‡§ü‡§Ç‡§ï‡•Ä ‡§∏‡§´‡§æ‡§à', '‡§®‡§à ‡§´‡§ø‡§ü‡§ø‡§Ç‡§ó', '‡§≤‡•Ä‡§ï‡•á‡§ú', '‡§ó‡•Ä‡§ú‡§∞ ‡§µ‡§∞‡•ç‡§ï', '‡§∏‡§ø‡§Ç‡§ï ‡§ú‡§æ‡§Æ'],
        'ELECTRICIAN': ['‡§™‡§Ç‡§ñ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞', '‡§µ‡§æ‡§Ø‡§∞‡§ø‡§Ç‡§ó', '‡§¨‡•ã‡§∞‡•ç‡§° ‡§´‡§ø‡§ü‡§ø‡§Ç‡§ó', 'MCB ‡§ö‡•á‡§Ç‡§ú', '‡§á‡§®‡§µ‡§∞‡•ç‡§ü‡§∞'],
        'CARPENTER': ['‡§¶‡§∞‡§µ‡§æ‡§ú‡§æ ‡§≤‡•â‡§ï', '‡§ï‡•Å‡§∞‡•ç‡§∏‡•Ä ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞', '‡§Ö‡§≤‡§Æ‡§æ‡§∞‡•Ä', '‡§™‡•â‡§≤‡§ø‡§∂', '‡§¨‡•á‡§° ‡§´‡§ø‡§ü‡§ø‡§Ç‡§ó'],
        'RO SERVICE': ['‡•û‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ö‡•á‡§Ç‡§ú', '‡§Æ‡•á‡§Æ‡•ç‡§¨‡•ç‡§∞‡•á‡§®', '‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤‡•á‡§∂‡§®', '‡§™‡§Ç‡§™ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞', '‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏‡§ø‡§Ç‡§ó'],
        'CCTV': ['‡§ï‡•à‡§Æ‡§∞‡§æ ‡§´‡§ø‡§ü‡§ø‡§Ç‡§ó', 'DVR ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó', '‡§µ‡§æ‡§Ø‡§∞‡§ø‡§Ç‡§ó', '‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§µ‡•ç‡§Ø‡•Ç'],
        'FITTING': ['TV ‡§∏‡•ç‡§ü‡•à‡§Ç‡§°', '‡§™‡§∞‡•ç‡§¶‡§æ ‡§∞‡•â‡§°', '‡§Ü‡§à‡§®‡§æ ‡§´‡§ø‡§ü‡§ø‡§Ç‡§ó', '‡§®‡•á‡§Æ ‡§™‡•ç‡§≤‡•á‡§ü'],
        'CLEANING': ['‡§´‡•Å‡§≤ ‡§π‡§æ‡§â‡§∏', '‡§¨‡§æ‡§•‡§∞‡•Ç‡§Æ ‡§°‡•Ä‡§™', '‡§∏‡•ã‡§´‡§æ ‡§ï‡•ç‡§≤‡•Ä‡§®', '‡§™‡§æ‡§®‡•Ä ‡§ü‡§Ç‡§ï‡•Ä'],
        'AC SERVICE': ['‡§è‡§∏‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏', '‡§ó‡•à‡§∏ ‡§ö‡§æ‡§∞‡•ç‡§ú', '‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤‡•á‡§∂‡§®', 'PCB ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞'],
        'OTHER': ['‡§™‡•á‡§Ç‡§ü‡§∞', '‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä', '‡§µ‡•á‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó', '‡§ü‡§æ‡§á‡§≤ ‡§µ‡§∞‡•ç‡§ï']
    };

    function openSub(cat) {
        const modal = document.getElementById('sub-svc-modal');
        const container = document.getElementById('sub-list-container');
        document.getElementById('parent-svc-name').innerText = cat;
        container.innerHTML = "";
        subServices[cat].forEach(sub => {
            const div = document.createElement('div');
            div.className = 'box'; div.style.height = '65px';
            div.innerHTML = `<span style="font-size:11px;">${sub}</span>`;
            div.onclick = () => {
                document.getElementById('svc-title').innerText = cat + " - " + sub;
                modal.style.display = 'none';
                showPage('booking-page', document.querySelectorAll('.nav-item')[1]);
            };
            container.appendChild(div);
        });
        modal.style.display = 'block';
    }

    // --- CUSTOMER DATA LOGIC ---
    function openCustData() {
        document.getElementById('cust-list-modal').style.display = 'block';
        loadCustData();
    }

    async function loadCustData() {
        const cont = document.getElementById('cust-container');
        cont.innerHTML = "<p style='text-align:center; padding:20px;'>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>";
        try {
            const res = await fetch(`${scriptURL}?action=getList&type=AK`);
            const data = await res.json();
            renderCust(data);
        } catch(e) { cont.innerHTML = "‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à!"; }
    }

    function renderCust(data) {
        const cont = document.getElementById('cust-container');
        cont.innerHTML = "";
        data.reverse().forEach(c => {
            cont.innerHTML += `
                <div class="team-card" data-id="${c.id}" data-name="${c.name.toLowerCase()}">
                    <div style="display:flex; align-items:center;">
                        <input type="checkbox" class="cust-check" value="${c.phone}" data-cname="${c.name}">
                        <div>
                            <div style="font-weight:bold; color:#333;">${c.name}</div>
                            <div style="font-size:11px; color:var(--primary);">ID: ${c.id} | ${c.service}</div>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <a href="tel:${c.phone}" style="color:var(--success); font-size:18px;"><i class="fas fa-phone-alt"></i></a>
                        <a href="https://wa.me/91${c.phone}" style="color:#25d366; font-size:18px;"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>`;
        });
    }

    function toggleAllCust() {
        const isChecked = document.getElementById('selectAllCust').checked;
        document.querySelectorAll('.cust-check').forEach(cb => cb.checked = isChecked);
    }

    function filterCust() {
        const search = document.getElementById('cSearchId').value.toLowerCase();
        document.querySelectorAll('#cust-container .team-card').forEach(card => {
            const id = card.getAttribute('data-id').toLowerCase();
            const name = card.getAttribute('data-name');
            card.style.display = (id.includes(search) || name.includes(search)) ? "flex" : "none";
        });
    }

    // --- OFFER BROADCAST LOGIC ---
    function openOfferModal() {
        const selected = document.querySelectorAll('.cust-check:checked');
        if(selected.length === 0 && document.getElementById('cust-list-modal').style.display === 'block') {
            return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç!");
        }
        document.getElementById('offer-modal').style.display = 'block';
    }

    async function startBroadcast() {
        const offerText = document.getElementById('offerMessage').value;
        if(!offerText) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ë‡§´‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≤‡§ø‡§ñ‡•á‡§Ç!");

        let targets = [];
        const selectedCheckboxes = document.querySelectorAll('.cust-check:checked');
        
        if(selectedCheckboxes.length > 0) {
            selectedCheckboxes.forEach(cb => targets.push({ name: cb.getAttribute('data-cname'), phone: cb.value }));
        } else {
            if(!confirm("‡§Ü‡§™‡§®‡•á ‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§ö‡•Å‡§®‡§æ ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§™‡•Ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
            const res = await fetch(`${scriptURL}?action=getList&type=AK`);
            const data = await res.json();
            data.forEach(c => targets.push({ name: c.name, phone: c.phone }));
        }

        alert(`${targets.length} ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡•§`);

        targets.forEach((t, index) => {
            setTimeout(() => {
                const finalMsg = `*AK SOLUTION HUB - ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§ë‡§´‡§∞* üéÅ%0A` +
                                 `--------------------------------%0A` +
                                 `‡§®‡§Æ‡§∏‡•ç‡§§‡•á *${t.name}*,%0A%0A` + 
                                 `‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§ñ‡§æ‡§∏ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§π‡•à:%0A` +
                                 `*${encodeURIComponent(offerText)}*%0A%0A` +
                                 `‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§ø‡§™‡•ç‡§≤‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§%0A` +
                                 `üìû *9927464530*%0A` +
                                 `--------------------------------%0A` +
                                 `‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;
                window.open(`https://wa.me/91${t.phone}?text=${finalMsg}`, '_blank');
            }, index * 3000);
        });
    }

    // --- TEAM LIST LOGIC ---
    let tFilter = 'ALL';
    function openTeamList() {
        document.getElementById('team-list-modal').style.display = 'block';
        loadTeamData();
    }
    function setTFilter(f) {
        tFilter = f;
        document.querySelectorAll('.stat-filter-btn').forEach(b => b.classList.remove('active-f'));
        document.getElementById('f-' + f.toLowerCase()).classList.add('active-f');
        filterTeam();
    }
    async function loadTeamData() {
        const cont = document.getElementById('team-container');
        cont.innerHTML = "‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        try {
            const res = await fetch(`${scriptURL}?action=getList&type=TEAM`);
            const data = await res.json();
            renderTeam(data);
        } catch(e) { cont.innerHTML = "‡§è‡§∞‡§∞!"; }
    }
    function renderTeam(data) {
        const cont = document.getElementById('team-container');
        cont.innerHTML = "";
        data.forEach(t => {
            const status = t.status || "FREE";
            const dot = status === 'FREE' ? 'dot-free' : 'dot-busy';
            cont.innerHTML += `
                <div class="team-card" data-id="${t.id}" data-status="${status}">
                    <div>
                        <div style="font-size:10px; font-weight:bold;"><span class="status-dot ${dot}"></span>${status}</div>
                        <div style="font-weight:bold; color:#333;">${t.name}</div>
                        <div style="font-size:11px; color:var(--primary);">ID: ${t.id} | ${t.service}</div>
                    </div>
                    <a href="tel:${t.phone}" style="color:var(--success); font-size:20px;"><i class="fas fa-phone-alt"></i></a>
                </div>`;
        });
    }
    function filterTeam() {
        const search = document.getElementById('tSearchId').value.toUpperCase();
        document.querySelectorAll('.team-card').forEach(card => {
            const id = card.getAttribute('data-id').toUpperCase();
            const stat = card.getAttribute('data-status');
            const mId = id.includes(search);
            const mStat = (tFilter === 'ALL' || stat === tFilter);
            card.style.display = (mId && mStat) ? "flex" : "none";
        });
    }

    // --- ASSIGN & ID CARD LOGIC ---
    function openAssignModal() { document.getElementById('assign-modal').style.display = 'block'; }
    async function processAssign() {
        const cid = document.getElementById('assign-cust-id').value.trim().toUpperCase();
        const tid = document.getElementById('assign-team-id').value.trim().toUpperCase();
        if(!cid || !tid) return alert("ID ‡§≠‡§∞‡•á‡§Ç!");
        try {
            const [rC, rT] = await Promise.all([
                fetch(`${scriptURL}?action=track&id=${cid}`).then(r => r.json()),
                fetch(`${scriptURL}?action=track&id=${tid}`).then(r => r.json())
            ]);
            if(rC.status === "Found" && rT.status === "Found") {
                const wMsg = `*TASK:* ${rC.id}%0A*NAME:* ${rC.name}%0A*ADDR:* ${rC.address}`;
                window.open(`https://wa.me/91${rT.phone}?text=${wMsg}`);
            } else alert("ID No Found");
        } catch(e) { alert("Error"); }
    }

    function openIDEntry() { document.getElementById('id-entry-modal').style.display = 'block'; }
    async function startFetchingID() {
        let tid = document.getElementById('custom-id-input').value.trim().toUpperCase();
        const res = await fetch(`${scriptURL}?action=track&id=${tid}`);
        const data = await res.json();
        if(data.status === "Found") {
            document.getElementById('card-name').innerText = data.name;
            document.getElementById('card-id').innerText = data.id;
            document.getElementById('card-phone').innerText = data.phone;
            document.getElementById('card-svc').innerText = data.service || "TECH STAFF";
            document.getElementById('id-entry-modal').style.display = 'none';
            document.getElementById('id-card-modal').style.display = 'block';
        }
    }

    function previewImg(i) {
        if (i.files && i.files[0]) {
            var r = new FileReader();
            r.onload = function(e) {
                document.getElementById('worker-img-preview').src = e.target.result;
                document.getElementById('worker-img-preview').style.display = 'block';
                document.getElementById('cam-icon').style.display = 'none';
                document.getElementById('digital-stamp').style.display = 'flex';
            };
            r.readAsDataURL(i.files[0]);
        }
    }

    function sendIDAsPDF() {
        const element = document.getElementById('id-card-print');
        html2pdf().from(element).save();
    }

    // Slider
    let idx = 0; setInterval(() => { const s = document.getElementById('mainSlider'); if(s) { idx = (idx + 1) % 5; s.style.transform = `translateX(${-idx * 20}%)`; } }, 3500);
    function askLocation() { if(navigator.geolocation) { navigator.geolocation.getCurrentPosition(p => { document.getElementById('locBtn').innerText = "‚úÖ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§"; document.getElementById('finalBtn').style.display = "block"; }); } }
    
    // --- FINAL BOOKING SUBMIT (ADDED) ---
    async function finalSubmit() {
        const name = document.getElementById('uName').value;
        const phone = document.getElementById('uPhone').value;
        const addr = document.getElementById('uAddr').value;
        const svc = document.getElementById('svc-title').innerText;

        if(!name || !phone) return alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç!");

        try {
            const response = await fetch(`${scriptURL}?action=book&name=${encodeURIComponent(name)}&phone=${phone}&address=${encodeURIComponent(addr)}&service=${encodeURIComponent(svc)}`);
            alert("‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§! ‡§Ü‡§™‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§");
            location.reload();
        } catch(e) {
            alert("‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§è‡§∞‡§∞! ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ü‡§™‡§ï‡•Ä ‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•â‡§≤ ‡§¨‡•à‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§");
        }
    }
</script>
</body>
</html>
